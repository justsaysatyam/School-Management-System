{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - Mid Point School{% endblock %}

{% block body %}
<div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-brand">
            <div class="brand-icon">ğŸ«</div>
            <div>
                <h2>Mid Point School</h2>
                <small style="opacity: 0.7; font-size: 0.75rem;">Admin Dashboard</small>
            </div>
        </div>

        <nav>
            <ul class="sidebar-nav">
                <li class="nav-item">
                    <a href="{% url 'admin_dashboard' %}" class="nav-link active">
                        <span class="icon">ğŸ“Š</span> Dashboard
                    </a>
                </li>

                <span class="nav-section-title">Management</span>
                <li class="nav-item">
                    <a href="{% url 'student_list' %}" class="nav-link">
                        <span class="icon">ğŸ“</span> Students
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'teacher_list' %}" class="nav-link">
                        <span class="icon">ğŸ‘¨â€ğŸ«</span> Teachers
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'class_list' %}" class="nav-link">
                        <span class="icon">ğŸ›ï¸</span> Classes
                    </a>
                </li>

                <span class="nav-section-title">Attendance</span>
                <li class="nav-item">
                    <a href="{% url 'teacher_attendance_list' %}" class="nav-link">
                        <span class="icon">ğŸ“‹</span> Teacher Attendance
                    </a>
                </li>

                <span class="nav-section-title">Finance</span>
                <li class="nav-item">
                    <a href="{% url 'fee_collection' %}" class="nav-link">
                        <span class="icon">ğŸ’°</span> Fee Collection
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'salary_management' %}" class="nav-link">
                        <span class="icon">ğŸ’µ</span> Salary Payments
                    </a>
                </li>

                <span class="nav-section-title">Results & Gallery</span>
                <li class="nav-item">
                    <a href="{% url 'result_verify' %}" class="nav-link">
                        <span class="icon">âœ…</span> Verify Results
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'result_list' %}" class="nav-link">
                        <span class="icon">ğŸ“Š</span> View Results
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'gallery_list' %}" class="nav-link">
                        <span class="icon">ğŸ–¼ï¸</span> Gallery
                    </a>
                </li>

                <span class="nav-section-title">Communication</span>
                <li class="nav-item">
                    <a href="{% url 'notice_list' %}" class="nav-link">
                        <span class="icon">ğŸ“¢</span> Notices
                    </a>
                </li>

                <li class="nav-item" style="margin-top: 2rem;">
                    <a href="{% url 'logout' %}" class="nav-link">
                        <span class="icon">ğŸšª</span> Logout
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="top-header">
            <h1 class="page-title">Dashboard Overview</h1>
            <div class="header-actions">
                <div class="user-profile">
                    <div class="user-avatar">{{ request.session.user_name|slice:":1"|upper }}</div>
                    <div>
                        <strong>{{ request.session.user_name }}</strong>
                        <div style="font-size: 0.75rem; color: var(--gray-500);">Administrator</div>
                    </div>
                </div>
            </div>
        </div>

        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{% if message.tags == 'error' %}error{% else %}{{ message.tags }}{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}

        <!-- Financial Stats -->
        <div class="stats-grid animate-slideUp">
            <div class="stat-card revenue">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-content">
                    <h3>Total Revenue</h3>
                    <div class="stat-value">â‚¹{{ total_revenue|floatformat:0 }}</div>
                    <div class="stat-change positive">All fees collected</div>
                </div>
            </div>

            <div class="stat-card expense">
                <div class="stat-icon">ğŸ’¸</div>
                <div class="stat-content">
                    <h3>Total Spend</h3>
                    <div class="stat-value">â‚¹{{ total_spend|floatformat:0 }}</div>
                    <div class="stat-change">All salaries paid</div>
                </div>
            </div>

            <div class="stat-card income">
                <div class="stat-icon">ğŸ“ˆ</div>
                <div class="stat-content">
                    <h3>Net Income</h3>
                    <div class="stat-value">â‚¹{{ net_income|floatformat:0 }}</div>
                    <div class="stat-change {% if net_income >= 0 %}positive{% else %}negative{% endif %}">
                        Revenue - Expenses
                    </div>
                </div>
            </div>

            <div class="stat-card info">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-content">
                    <h3>Total Students</h3>
                    <div class="stat-value">{{ total_students }}</div>
                    <div class="stat-change">Active students</div>
                </div>
            </div>
        </div>

        <!-- Secondary Stats -->
        <div class="stats-grid" style="margin-bottom: 2rem;">
            <div class="stat-card info">
                <div class="stat-icon">ğŸ‘¨â€ğŸ«</div>
                <div class="stat-content">
                    <h3>Total Teachers</h3>
                    <div class="stat-value">{{ total_teachers }}</div>
                </div>
            </div>

            <div class="stat-card info">
                <div class="stat-icon">ğŸ›ï¸</div>
                <div class="stat-content">
                    <h3>Total Classes</h3>
                    <div class="stat-value">{{ total_classes }}</div>
                </div>
            </div>

            <div class="stat-card expense">
                <div class="stat-icon">âš ï¸</div>
                <div class="stat-content">
                    <h3>Pending Fees</h3>
                    <div class="stat-value">{{ pending_fees }}</div>
                </div>
            </div>

            <div class="stat-card expense">
                <div class="stat-icon">â³</div>
                <div class="stat-content">
                    <h3>Pending Salaries</h3>
                    <div class="stat-value">{{ pending_salaries }}</div>
                </div>
            </div>
        </div>

        <!-- Recent Payments -->
        <div class="grid-2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Fee Payments</h3>
                    <a href="{% url 'fee_collection' %}" class="btn btn-sm btn-outline">View All</a>
                </div>
                <div class="table-container" style="box-shadow: none;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in recent_fee_payments %}
                            <tr>
                                <td>{{ payment.student.name }}</td>
                                <td>â‚¹{{ payment.paid_amount }}</td>
                                <td>
                                    <span
                                        class="badge badge-{% if payment.status == 'Paid' %}success{% elif payment.status == 'Pending' %}warning{% else %}info{% endif %}">
                                        {{ payment.status }}
                                    </span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center text-muted">No payments yet</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Salary Payments</h3>
                    <a href="{% url 'salary_management' %}" class="btn btn-sm btn-outline">View All</a>
                </div>
                <div class="table-container" style="box-shadow: none;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Teacher</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in recent_salary_payments %}
                            <tr>
                                <td>{{ payment.teacher.name }}</td>
                                <td>â‚¹{{ payment.paid_amount }}</td>
                                <td>
                                    <span
                                        class="badge badge-{% if payment.status == 'Paid' %}success{% elif payment.status == 'Pending' %}warning{% else %}info{% endif %}">
                                        {{ payment.status }}
                                    </span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center text-muted">No salary payments yet</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mt-4">
            <div class="card-header">
                <h3 class="card-title">Quick Actions</h3>
            </div>
            <div class="flex gap-2" style="flex-wrap: wrap;">
                <a href="{% url 'student_add' %}" class="btn btn-primary">â• Add Student</a>
                <a href="{% url 'teacher_add' %}" class="btn btn-success">â• Add Teacher</a>
                <a href="{% url 'teacher_attendance_list' %}" class="btn btn-info">ğŸ“‹ Mark Attendance</a>
                <a href="{% url 'fee_add' %}" class="btn btn-warning">ğŸ’° Collect Fee</a>
                <a href="{% url 'salary_add' %}" class="btn btn-danger">ğŸ’µ Pay Salary</a>
                <a href="{% url 'notice_add' %}" class="btn btn-outline">ğŸ“¢ Create Notice</a>
                <a href="{% url 'result_verify' %}" class="btn btn-primary">âœ… Verify Results</a>
                <a href="{% url 'gallery_list' %}" class="btn btn-info">ğŸ–¼ï¸ Manage Gallery</a>
            </div>
        </div>
    </main>
</div>
{% endblock %}